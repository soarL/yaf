<?php $this->display('header.html');?>
<div id="user-app">
    <?php $this->display('position.html');?>
    <!-- 主体 的右边-->
    <div class="container admin_body">
        <?php $this->display('menu.html');?>
        <div class="admin_right_body">
        	<div class="userSetBody">
			<h1 class="userSetTitle">绑定银行卡</h1>
			<div>
				<form id="open-custody-form" class="user-form" action="/account/openBaofoo" method="post">
			      <input type="hidden" name="type" value="<?=$type?>">
			      <div class="input-wrap mt10 w clearfix">
			      	<span class="cRed">*</span>
			        <label class="label">手机号码</label>
			        <div class="static-input">
			          <!-- <span><?=_hide_phone($user->phone)?></span> -->
			          <input class="ui-input input-icon" id="custody-phone" name="phone" type="text" placeholder="请输入您的手机号码" />
			        </div>
			      </div>
			      <!-- <div class="input-wrap mt10 w clearfix">
			        <span class="cRed">*</span>
			        <label class="label">真实姓名</label>
			        <input class="ui-input input-icon" id="custody-name" name="name" type="text" placeholder="请输入您的真实姓名" />
			      </div> -->
			      <!-- <div class="input-wrap mt10 w clearfix">
			        <span class="cRed">*</span>
			        <label class="label">身份证</label>
			        <input class="ui-input input-icon" id="custody-cardnum" name="cardnum" type="text" placeholder="请输入您的身份证号" />
			      </div> -->
			      <input class="ui-input input-icon" id="custody-name" name="name" value="<?=$user->name?>" type="hidden"/>
			      <input class="ui-input input-icon" id="custody-cardnum" name="cardnum" value="<?=$user->cardnum?>" type="hidden"/>
			      <div class="input-wrap mt10 w clearfix">
			        <span class="cRed">*</span>
			        <label class="label">银行卡号</label>
			        <input class="ui-input input-icon" id="custody-bankNum" name="bankNum" type="text" placeholder="请输入您的银行卡号" />
			      </div>
			      <div class="input-wrap mt10 w clearfix" style="display: none;">
			        <span class="cRed">*</span>
			        <label class="label">类型</label>
			        <input class="ui-input input-icon" id="custody-card_type1" checked name="card_type" type="radio" value="101" style="width:25px;"/>
			        <label for="custody-card_type1" class="radio-label">借记卡</label>
	<!-- 		        <input class="ui-input input-icon" id="custody-card_type2" name="card_type" type="radio" value="102" style="width:25px;"/>
			        <label for="custody-card_type2" class="radio-label">信用卡</label> -->
			      </div>
			      <div class="input-wrap mt10 w clearfix credit">
			        <span class="cRed">*</span>
			        <label class="label">银行卡有效期</label>
			        <input class="ui-input input-icon" id="custody-valid_date" name="valid_date" type="text" placeholder="请输入您的银行卡有效期" />
			      </div>
			      <div class="input-wrap mt10 w clearfix credit">
			        <span class="cRed">*</span>
			        <label class="label">银行卡安全码</label>
			        <input class="ui-input input-icon" id="custody-cvv" name="cvv" type="text" placeholder="请输入您的银行卡安全码" />
			      </div>
			      <input type="hidden" name="unique_code" id="unique_code">
			      <!-- <div class="input-wrap mt10 w clearfix">
			        <span class="cRed">*</span>
			        <label class="label">验证码</label>
			        <input class="ui-input input-icon" id="custody-sms_code" name="sms_code" type="text" placeholder="请输入验证码" /> 
			        <button type="button" id="get-sms_code">获取验证码</button>
			      </div> -->
			      <div class="mt10 checkbox-wrap">
			        <!-- <label style="color: #666;"><input id="custody-check" type="checkbox" /> 我已阅读并同意</label>
			        	<a style="color: #03a2ff;" href="<?=WEB_MAIN?>/safe/custody" target="_blank">《开户协议》</a> -->
			      </div>
			      <div class="mt30 button-wrap">
			        <input type="button" value="下一步" class="btn-blue loginbtn pr get-sms_code">
			      </div>
			      </form>
			</div>
		</div>
		<div id="confirm-box" class="user-form" style="display: none;padding:10px 15px">
			<div class="input-wrap mt10 w clearfix">
		        <label class="label" style="width:60px">验证码</label>
		        <input class="ui-input input-icon" id="custody-sms_code" name="sms_code" type="text" placeholder="请输入验证码" /> 
		        <button type="button" class="get-sms_code" id="get-sms_code">重新获取</button>
	        </div>
	        <div class="mt30 button-wrap">
	        	<input type="button" value="认证" id="confirm" class="btn-blue loginbtn pr">
	        </div>
		</div>
        </div>
    </div>
</div>
<style type="text/css">
	#get-sms_code{
		width: 110px;
		height: 40px;
	    display: inline-block;
	    padding: 6px 12px;
	    font-size: 14px;
	    line-height: 1.42857143;
	    color: #555;
	    background-color: #eee;
	    background-image: none;
	    border: 1px solid #ccc;
	    border-radius: 4px;
	    -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075);
	    box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075);
	    -webkit-transition: border-color ease-in-out .15s, -webkit-box-shadow ease-in-out .15s;
	    -o-transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
	    transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
	}
	.user-form .mt10 {margin-top: 10px;}
	.user-form .mt30 {margin-top: 30px;}

	.user-form {
		padding: 30px 50px;
	}
	.user-form .input-wrap {
		margin: 15px 0px;
		line-height: 40px;
	}
	.user-form .input-wrap .ui-input {
		width: 180px;
		height: 25px;
	    display: inline-block;
	    padding: 6px 12px;
	    font-size: 14px;
	    line-height: 1.42857143;
	    color: #555;
	    background-color: #fff;
	    background-image: none;
	    border: 1px solid #ccc;
	    border-radius: 4px;
	    -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075);
	    box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075);
	    -webkit-transition: border-color ease-in-out .15s, -webkit-box-shadow ease-in-out .15s;
	    -o-transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
	    transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
	}
	.user-form .input-wrap .static-input {
		color: #03a2ff;
		float: left;
	}
	.user-form .input-wrap .cRed {
		float: left;
		color: #f00;
		width: 30px;
	}
	.user-form .input-wrap .label {
		color: #666;
		float: left;
		width: 100px;
		text-align: right;
		margin-right: 20px;
	}
	.user-form .btn-blue {
	    color: #fff;
	    padding: 8px 23px;
	    border-radius: 4px;
	    background-color: #03a2ff;
	    border: none;
	    margin: auto;
	    display: table;
	}
	.credit{
		display: none
	}
	.alert-msg{
		padding: 15px 0 15px 15px;
		width: 250px;
	}
</style>

<script type="text/javascript">require(['Index/user','ebox'],function(user,ebox){
	$('#custody-card_type1').click(function(){
		$('.credit').hide();
	})
	$('#custody-card_type2').click(function(){
		$('.credit').show();
	})
	$('#confirm').click(function(){
		ebox.closeAll();
		var lay = ebox.open({
			type:3
		})
		if($('#custody-phone').val()){
			var phone = $('#custody-phone').val();
		}else{
			ebox.open({
	          type: 1,
	          title: '提示',
	          content: '<div class="alert-msg">请填写手机号</div>'
	        });
	        return
		}
		if($('#custody-name').val()){
			var name = $('#custody-name').val();
		}else{
			ebox.open({
	          type: 1,
	          title: '提示',
	          content: '<div class="alert-msg">请填写真实姓名</div>'
	        });
	        return
		}
		if($('#custody-cardnum').val()){
			var cardnum = $('#custody-cardnum').val();
		}else{
			ebox.open({
	          type: 1,
	          title: '提示',
	          content: '<div class="alert-msg">请填写身份证</div>'
	        });
	        return
		}
		if($('#custody-bankNum').val()){
			var bankNum = $('#custody-bankNum').val();
		}else{
			ebox.open({
	          type: 1,
	          title: '提示',
	          content: '<div class="alert-msg">请填写银行卡号</div>'
	        });
	        return
		}
		if($('#custody-card_type2:checked').val()){
			var card_type = $('#custody-card_type2:checked').val();
			if($('#custody-valid_date').val()){
				var valid_date = $('#custody-valid_date').val();
			}else{
				ebox.open({
		          type: 1,
		          title: '提示',
		          content: '<div class="alert-msg">请填写银行卡有效期</div>'
		        });
		        return
			}
			if($('#custody-cvv').val()){
				var cvv = $('#custody-cvv').val();
			}else{
				ebox.open({
		          type: 1,
		          title: '提示',
		          content: '<div class="alert-msg">请填写银行卡安全码</div>'
		        });
		        return
			}
		}else{
			var card_type = $('#custody-card_type1:checked').val();
		}

		var sms_code = $('#custody-sms_code').val();
		var unique_code = $('#unique_code').val();

		$.ajax({
			type: "POST",
            url: "/account/bindBaofoo",
            data: {name:name,cardnum:cardnum,bankNum:bankNum,phone:phone,card_type:card_type,valid_date:valid_date,cvv:cvv,sms_code:sms_code,unique_code:unique_code},
            dataType: "json",
            success: function(data){
            	ebox.close(lay);
            	if(data.status == -1){
            		ebox.open({
			          type: 1,
			          title: '提示',
			          content: '<div class="alert-msg">'+data.info+'</div>',
			          end:function(){
					        ebox.open({
								type:1,
								title:'请输入短信验证码!',
								content:$('#confirm-box')
							})
			          	}
			        });
            	}else{
            		window.location.href = '/account/bank';
            	}
	        }
		})
	})
	$('.get-sms_code').click(function(){
		ebox.closeAll();
		if($('#custody-phone').val()){
			var phone = $('#custody-phone').val();
		}else{
			ebox.open({
	          type: 1,
	          title: '提示',
	          content: '<div class="alert-msg">请填写手机号</div>'
	        });
	        return
		}
		if($('#custody-name').val()){
			var name = $('#custody-name').val();
		}else{
			ebox.open({
	          type: 1,
	          title: '提示',
	          content: '<div class="alert-msg">请填写真实姓名</div>'
	        });
	        return
		}
		if($('#custody-cardnum').val()){
			var cardnum = $('#custody-cardnum').val();
		}else{
			ebox.open({
	          type: 1,
	          title: '提示',
	          content: '<div class="alert-msg">请填写身份证</div>'
	        });
	        return
		}
		if($('#custody-bankNum').val()){
			var bankNum = $('#custody-bankNum').val();
		}else{
			ebox.open({
	          type: 1,
	          title: '提示',
	          content: '<div class="alert-msg">请填写银行卡号</div>'
	        });
	        return
		}
		if($('#custody-card_type2:checked').val()){
			var card_type = $('#custody-card_type2:checked').val();
			if($('#custody-valid_date').val()){
				var valid_date = $('#custody-valid_date').val();
			}else{
				ebox.open({
		          type: 1,
		          title: '提示',
		          content: '<div class="alert-msg">请填写银行卡有效期</div>'
		        });
		        return
			}
			if($('#custody-cvv').val()){
				var cvv = $('#custody-cvv').val();
			}else{
				ebox.open({
		          type: 1,
		          title: '提示',
		          content: '<div class="alert-msg">请填写银行卡安全码</div>'
		        });
		        return
			}
		}else{
			var card_type = $('#custody-card_type1:checked').val();
		}

		var lay = ebox.open({
			type:3
		})

		//settime($(this),30);
		$.ajax({
			type: "POST",
            url: "/account/openBaofoo1",
            data: {name:name,cardnum:cardnum,bankNum:bankNum,phone:phone,card_type:card_type,valid_date:valid_date,cvv:cvv},
            dataType: "json",
            success: function(data){
            	if(data.status == -1){
            		ebox.close(lay);
            		ebox.open({
			          type: 1,
			          title: '提示',
			          content: '<div class="alert-msg">'+data.info+'</div>'
			        });
            	}else{
            		ebox.close(lay);
					ebox.open({
						type:1,
						title:'请输入短信验证码!',
						content:$('#confirm-box')
					})
            		$('#unique_code').val(data.unique_code);
            	}
	        }
		})
	})

	function settime(val,countdown) { 
		if (countdown == 0) { 
			val.attr("disabled",false);
			val.html('获取验证码');
			$('#get-sms_code').show();
			countdown = countdown; 
		} else { 
			$('#get-sms_code').hide();
			//val.attr("disabled", true); 
			//val.html("重新发送(" + countdown + ")"); 
			countdown--; 
			setTimeout(function() { 
				settime(val,countdown) 
			},1000) 
		} 
	}
})</script>
<?php $this->display('footer.html');?>