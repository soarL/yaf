<?php 
	use Yaf\Registry;
  	$loginUser = Registry::get('session')->get('user');
?>
<?php $this->display('header.html');?>
<div class="greybg">
	<div class="main mainwithborder">
		<div class="step-wrap">
			<a class="step step1 <?php if($step==1||$step==2||$step==3):?>stepsel<?php endif;?>"> <i>1</i>
				<span>填写用户信息</span>
			</a>
			<a class="step step2 <?php if($step==2||$step==3):?>stepsel<?php endif;?>"> <i>2</i>
				<span>手机信息验证</span>
			</a>
			<?php if($step==3):?>
			<a class="step step3 stepsel">
				<i>3</i>
				<?php if($status==1):?>
				<span>注册成功</span>
				<?php else:?>
				<span class="error">注册失败</span>
				<?php endif;?>
			</a>
			<?php else:?>
			<a class="step step3">
				<i>3</i>
				<span>注册成功</span>
			</a>
			<?php endif;?>
		</div>
		<?php if($step==1):?><p style="color: #666; padding-right: 100px; text-align: right;">已有账号？<a href="<?=WEB_LOGIN?>" class="no_unl cBlue ml5">立即登录</a></p><?php endif;?>
		<div class="register-content">
			<?php if($step==1):?>
			<div class="register-box">
				<form method="post" action="/register" id="reg-form">
					<input type="hidden" name="step" value="<?php echo $step;?>">
					<div>
						<div class="input-wrap mt20 clearfix w valid-item">
							<span class="cRed">*</span>
							<label>用户名</label>
							<input class="ui-input input-icon" placeholder="请输入用户名" type="text" name="username" id="username">
							<span class="ico-item ico-person"></span>
							<div class="prompt"></div>
						</div>
						<div class="input-wrap mt30 clearfix w valid-item">
							<span class="cRed">*</span>
							<label>手机号码</label>
							<input class="ui-input input-icon" placeholder="请输入手机号" type="text" name="phone" id="phone">
							<span class="ico-item ico-phone"></span>
							<div class="prompt"></div>
						</div>

						<div class="input-wrap mt30 clearfix w valid-item">
							<span class="cRed">*</span>
							<label>登录密码</label>
							<input class="ui-input input-icon" placeholder="请输入密码" type="password" name="password" id="password">
							<span class="ico-item ico-lock"></span>
							<div class="prompt"></div>
						</div>
						<div class="input-wrap mt30 clearfix w valid-item">
							<span class="cRed">*</span>
							<label>重复密码</label>
							<input class="ui-input input-icon" placeholder="请再次输入密码" type="password" name="passwordSure" id="passwordSure">
							<span class="ico-item ico-lock"></span>
							<div class="prompt"></div>
						</div>
						<!-- <div class="input-wrap mt30 clearfix w valid-item">
							<span class="cRed">*</span>
							<label>选择角色</label>
							<a class="choose-role choose-role-left rolesel" choose-data="on" data-val="1">我要理财</a>
							<a class="choose-role choose-role-right" choose-data="off" data-val="2">我要借款</a>
							<input id="reg-role" type="hidden" name="role" value="1">
							<div class="prompt"></div>
						</div> -->
						<div class="clearfix mt30 valid-item">
							<div class="clearfix">
								<div class="input-wrap fl" style="width:200px">
									<span class="cRed ">*</span>
									<label >验证码</label>
									<input id="captcha" name="captcha" class="ui-input" placeholder="验证码" type="text" style="width:105px">
								</div>
								<a href="javascript:;" class="code-wrap reg-code-wrap fl ml10">
									<img id="captcha-img" src="<?php echo WEB_CAPTCHA;?>" onclick="this.src+='?'+Math.random()"/>
								</a>
								<a id="reload-captcha-btn" href="javascript:;" class="refreshico fl no_unl ml10 mt5">&nbsp;</a>
							</div>
							<div class="prompt prompt-forcode"></div>
						</div>
					</div>
					<?php if($spreadUser!=''):?>
					<div class="input-wrap clearfix w valid-item spread-user spread-user-show mt30 mb30">
						<span class="cRed">*</span>
						<label>推荐人</label>
						<input type="hidden" name="spreadUser" value="<?php echo $spreadUser;?>" id="spreadUser">
						<input class="ui-input disabled>" style="width:230px" placeholder="请填写推荐人用户名" type="text" name="spreadUser" value="<?php echo $spreadUser;?>" disabled>
						<div class="prompt"></div>
					</div>
					<?php else:?>
					<div id="spread-btn" class="static-input-wrap">
						<div class="static-input">
							推荐人用户名
						</div>
					</div>
					<div id="spread-input-wrap" class="input-wrap clearfix w valid-item spread-user open mb30" style="display:none;">
						<span class="cRed">*</span>
						<label>推荐人</label>
						<input class="ui-input" style="width:230px" placeholder="请填写推荐人用户名" type="text" name="spreadUser" id="spreadUser" value="<?php echo $spreadUser;?>">
						<div class="prompt"></div>
					</div>
					<?php endif;?>

					<!--<div class="clearfix mt50 pl50" >
						<span class="fl" style="color:#777">
							<input type="checkbox" class="ui-checkbox mr10" disabled="true" checked="true" />
							我已阅读并同意
						</span>
						<a href="/safe/contractSix" target="_blank" class="fl cBlue no_unl">《汇诚普惠网站服务协议》</a>
					</div>-->
					<div class="tc" style="width:407px">
						<div id="reg-btn-wrapper" class="reg-btn-wrapper">
							<input id="reg-btn" type="button" style="padding: 0 38px;height:45px;" value="同意用户协议并注册" class="btn-blue loginbtn pr"/>
							<div id="prompt-xy" class="prompt-xy prompt-container">
								<div class="prompt-content">点击注册即同意<br><a href="<?php echo WEB_MAIN;?>/safe/contractSix" target="_blank">汇诚普惠用户协议</a></div>
								<div class="container-arrow"></div>
							</div>
						</div>
					</div>
				</form>
			</div>
			<?php elseif($step==2):?>
			<div class="register-box" style="height:320px;">
				<div class="alert alert-success step-top">短信已发送至您手机，请输入短信中的验证码，确保您的手机号真实有效。</div>
				<form method="post" action="/register" id="reg-two-form">
					<input type="hidden" name="step" value="<?php echo $step;?>">
					<input type="hidden" name="username" value="<?php echo $username;?>" id="username">
					<input type="hidden" name="phone" value="<?php echo $phone;?>" id="phone">
					<input type="hidden" name="password_hash" value="<?php echo $password_hash;?>">
					<input type="hidden" name="authCode" value="<?php echo $authCode;?>">
					<input type="hidden" name="randomCode" value="<?php echo $randomCode;?>">
					<input type="hidden" name="spreadUser" value="<?php echo $spreadUser;?>">
					<div>
						<div class="input-wrap mt30 clearfix w valid-item">
							<span class="cRed">*</span>
							<label>手机号码</label>
							<span class="static-input red"><?php echo $phone;?></span>
						</div>
						<div class="input-wrap mt30 clearfix w valid-item">
							<span class="cRed">*</span>
							<label>验证码</label>
							<input class="ui-input" placeholder="请输入手机验证码" type="text" name="phoneCode" id="phoneCode">
							<div class="prompt" style="left:290px;"></div>
						</div>
					</div>
					<div class="tc mt30" style="width:410px">
						<input id="reg-two-btn" type="button" value="提交验证" class="btn-blue loginbtn pr"/>
					</div>
				</form>
				<div class="re-send">注：如果您在1分钟之内没有收到验证码，请 <a href="/register">返回修改手机号</a> 或 <button id="resend-sms-btn" href="javascript:;">重新发送验证码</button> 。</div>
			</div>
			<?php elseif($step==3):?>
			<div class="register-box" style="height:320px;">
				<?php if($status==1):?>
				<div class="register-success">
					<div class="success-info">恭喜您，注册成功！</div>
					<div class="success-info-other">
						汇诚普惠已上线江西银行资金存管系统，请先开通江西银行存管账户后才可以进行充值、投标、提现等操作！
					</div>
					<div class="tc mt30" style="width:410px">
						<a class="btn-blue loginbtn pr" href="/account/custody">开通存管帐户</a>
					</div>
				</div>
				<?php else:?>
				<div class="register-fail">
					<div class="fail-info">很抱歉，注册失败！</div>
					<div class="fail-info-other">
						原因：<?php echo $info;?>
					</div>
				</div>
				<?php endif;?>
			</div>
			<script type="text/javascript">
			var _mvq = window._mvq || [];window._mvq = _mvq;
			_mvq.push(['$setAccount', 'm-183173-0']);

			_mvq.push(['$setGeneral', 'registered', '', '<?php echo $loginUser["username"];?>', '<?php echo $loginUser["userId"];?>']);
			_mvq.push(['$logConversion']);

			</script>
			<?php endif;?>
		</div>
	</div>
</div>
<?php $this->display('footer.html');?>