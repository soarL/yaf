<?php use models\Odd;?>
<?php $this->display('header.html');?>
<div class="row">
	<div class="col-xs-12">
		<div class="nav-tabs-custom">
			<div class="nav-tabs-tool">
				<a class="btn btn-box-tool" data-toggle="tooltip" data-original-title="Excel下载" href="?excel=1">
                	<i class="fa fa-file-excel-o text-red"></i>
            	</a>
			</div>
			<?php $this->display('repayment/common/tab-repay.html', ['type'=>'advance']);?>
			<div class="tab-content">
				<div class="row">
					<div class="col-sm-12">
						<form action="" class="table-search-form clearfix">
							<div class="form-group">
								<label class="control-label">名称</label>
								<div class="select-wrap">
									<?php $searchTypes = ['name'=>'用户姓名','chepai'=>'车牌号码', 'oddNumber'=>'标的号', 'userId' => '用户ID', 'username'=>'帐号', 'oddTitle'=>'借款标题', 'phone'=>'用户手机'];?>
									<select class="form-control input-sm" name="searchType">
										<?=_options($searchTypes, $queries->searchType);?>
									</select>
								</div>
								<input type="text" class="form-control input-sm inline-input" name="searchContent" placeholder="查询内容" value="<?=$queries->searchContent?>">
							</div>
							<div class="form-group">
								<label class="control-label time-label">添加时间</label>
								<div class="input-group time-group">
									<input type="text" class="form-control input-sm timepicker" data-allow-input="true" name="startTime" value="<?=$queries->startTime?>">
									<div class="input-group-btn">
										<button type="button" class="btn btn-sm">至</button>
									</div>
									<!-- /btn-group -->
									<input type="text" class="form-control input-sm timepicker" data-allow-input="true" name="endTime" value="<?=$queries->endTime?>">
								</div>
							</div>
							<div class="form-group">
								<label class="control-label">借款状态</label>
								<div class="select-wrap">
									<select class="form-control input-sm" name="progress">
										<option value="all" <?php if($queries->progress == 'all') echo 'selected';?>>全部</option>
										<option value="prep" <?php if($queries->progress == 'prep') echo 'selected';?>>未初审</option>
										<option value="start" <?php if($queries->progress == 'start') echo 'selected';?>>未复审</option>
										<option value="run" <?php if($queries->progress == 'run') echo 'selected';?>>还款中</option>
										<option value="end" <?php if($queries->progress == 'end') echo 'selected';?>>已结束</option>
										<option value="fron" <?php if($queries->progress == 'fron') echo 'selected';?>>提前还款</option>
										<option value="delay" <?php if($queries->progress == 'delay') echo 'selected';?>>逾期还款</option>
										<option value="fail" <?php if($queries->progress == 'fail') echo 'selected';?>>失效</option>
									</select>
								</div>
							</div>
							<input type="hidden" name="order" value=<?=$queries->order?>>
							<button type="submit" class="btn btn-sm btn-info">搜索</button>
						</form>
					</div>
				</div>
				<div class="row">
					<div class="col-sm-12">
						<table class="table table-hover mb-0" >
							<tr>
								<th class="visible-lg">借款人</th>
								<th>借款标题</th>
								<th class="visible-lg">借款类型</th>
								<th class="visible-lg">借款金额</th>
								<th class="visible-lg">借款期数</th>
								<th class="visible-lg">年利率</th>
								<th class="visible-lg">发布时间</th>
								<th class="visible-lg">到期时间</th>
								<th>状态</th>
								<th>优先级别</th>
								<th>操作</th>
							</tr>
							<?php foreach ($records as $record):?>
							<tr data-id="<?=$record->id?>" data-oddNumber="<?=$record->oddNumber?>" data-appointUserId="<?=$record->appointUserId?>" data-name="<?=$record->oddTitle?>">
								<td class="visible-lg">
									<?=$record->user->username?><a class="label label-primary" href="/admin/user/list?searchType=userId&searchContent=<?=$record->userId?>"><?=$record->userId?></a>
								</td>
								<td>
									<span class="label" style="background: <?=$record->getTypeName('color')?>"><?=$record->getTypeName('short')?></span>
									<a href="/admin/loan/invests?searchType=oddNumber&searchContent=<?=$record->oddNumber?>"><span class="label label-primary" data-toggle="tooltip" data-original-title="<?=$record->oddNumber?>">
										<?=$record->oddTitle?>
									</span></a>
								</td>
								<td class="visible-lg"><?=$record->getRepayType()?></td>
								<td class="visible-lg"><?=$record->oddMoney?></td>
								<td class="visible-lg"><?=$record->getPeriod()?></td>
								<td class="visible-lg">
									<?=$record->oddYearRate*100?>%
									<?php if($record->oddReward):?>+<?=$record->oddReward*100?>%<?php endif;?>
								</td>
								<td class="visible-lg"><?=_date('Y-m-d H:i', $record->openTime)?></td>
								<td class="visible-lg"><?=$record->getEndTime()?></td>
								<td><?=$record->getPRGName()?></td>
								<td><?=$record->getFron()?></td>
								<td>
									<a class="btn btn-ssm btn-info" href="<?=WEB_MAIN?>/odd/<?=$record->oddNumber?>" target="_blank"> 
										<i class="fa fa-eye icon-white"></i> 查看
									</a>
									<?php if($record->progress=='run'):?>
									<a class="btn btn-ssm btn-primary btn-generate-pr" href="/admin/repayment/takeAdvance?oddNumber=<?=$record->oddNumber?>&fronStatus=<?=$record->fronStatus==1?2:1;?>">
										<i class="fa fa-file-pdf-o"></i> <?=$record->fronStatus==1?'优先':'取消优先';?>
									</a>

									<a class="btn btn-ssm btn-primary btn-generate-pr" href="/admin/repayment/takeAdvance?oddNumber=<?=$record->oddNumber?>&fronStatus=0" >
										<i class="fa fa-file-pdf-o"></i> 退出
									</a>

									<a class="btn btn-ssm btn-danger btn-generate-pr" href="/admin/repayment/detail?id=<?=$record->getNextRepayID()?>&type=advance">
										<i class="fa fa-file-pdf-o"></i> 提前还款
									</a>
									<?php endif;?>

								</td>
							</tr>
							<?php endforeach;?>
						</table>
					</div>
				</div>
				<div class="row row-footer">
					<div class="col-sm-12">
					<?=$records->render()?>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<?php $this->display('footer.html');?>